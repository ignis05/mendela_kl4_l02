<!-- open with vscode live server -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
		<style>
			body {
				padding: 0;
				margin: 0;
				box-sizing: border-box;
			}
			#woj {
				width: 30%;
				min-width: 250px;
				padding: 5px;
			}
			.wojEl {
				border: 2px solid black;
				margin-top: 2px;
				padding: 3px;
			}
		</style>
		<script>
			// executes xpath query on xml object and returns array
			function xpathQuerry(xml, query) {
				let final = []
				let nodes = xml.evaluate(
					query,
					xml,
					null,
					XPathResult.ANY_TYPE,
					null
				)
				let result = nodes.iterateNext()
				while (result) {
					final.push(result.childNodes[0].nodeValue)
					result = nodes.iterateNext()
				}
				if ((final.length == 1)) {
					return final[0]
				}
				return final
			}

			fetch('http://localhost:5500/dane.xml')
				.then(res => res.text())
				.then(str =>
					new window.DOMParser().parseFromString(str, 'text/xml')
				)
				.then(data => {
					console.log(data)

					let woj = xpathQuerry(
						data,
						`//row[NAZWA_DOD='województwo']/NAZWA`
					)
					let woj_rich = woj.map(el => {
						return {
							name: el,
							id: xpathQuerry(
								data,
								`//row[NAZWA_DOD='województwo' and NAZWA='${el}']/WOJ`
							)
						}
					})
					console.log(woj_rich)
					woj_rich.forEach(el => {
						let x = document.createElement('div')
						x.classList.add('wojEl')
						x.innerHTML = el.name
						document.getElementById('woj').appendChild(x)
					})
				})
		</script>
	</head>
	<body>
		<div id="root">
			<div id="woj"></div>
		</div>
	</body>
</html>
