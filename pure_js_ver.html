<!-- open with vscode live server -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
		<style>
			body {
				padding: 0;
				margin: 0;
				box-sizing: border-box;
				user-select: none;
			}
			#root {
				display: flex;
				align-items: flex-start;
				justify-content: flex-start;
			}
			#woj {
				width: 30%;
				min-width: 250px;
				padding: 5px;
			}
			.listEL {
				border: 2px solid black;
				margin-top: 2px;
				padding: 3px;
			}
			#miast {
				width: 50%;
				min-width: 250px;
				padding: 5px;
			}
			.wojEl {
				cursor: pointer;
			}
		</style>
		<script>
			// executes xpath query on xml object and returns array
			function xpathQuery(xml, query) {
				let final = []
				let nodes = xml.evaluate(
					query,
					xml,
					null,
					XPathResult.ANY_TYPE,
					null
				)
				let result = nodes.iterateNext()
				while (result) {
					final.push(result.childNodes[0].nodeValue)
					result = nodes.iterateNext()
				}
				if (final.length == 1) {
					return final[0]
				}
				return final
			}

			fetch('http://localhost:5500/data.xml')
				.then(res => res.text())
				.then(str =>
					new window.DOMParser().parseFromString(str, 'text/xml')
				)
				.then(data => {
					console.log(data)

					let woj = xpathQuery(
						data,
						`//row[NAZWA_DOD='województwo']/NAZWA`
					)
					let woj_obj = woj.map(el => {
						return {
							name: el,
							id: xpathQuery(
								data,
								`//row[NAZWA_DOD='województwo' and NAZWA='${el}']/WOJ`
							)
						}
					})
					console.log(woj_obj)

					function displayMiast(woj_id) {
						let miast = xpathQuery(
							data,
							`//row[WOJ='${woj_id}' and (NAZWA_DOD='miasto' or NAZWA_DOD='miasto na prawach powiatu' or NAZWA_DOD='miasto stołeczne, na prawach powiatu')]/NAZWA`
						)
						console.log(miast)
						document.getElementById('miast').innerHTML = ''
						miast.forEach(el => {
							let x = document.createElement('div')
							x.classList.add('listEL')
							x.innerHTML = el
							document.getElementById('miast').appendChild(x)
						})
					}

					woj_obj.forEach(el => {
						let x = document.createElement('div')
						x.classList.add('listEL')
						x.classList.add('wojEl')
						x.innerHTML = el.name
						document.getElementById('woj').appendChild(x)
						x.onclick = () => displayMiast(el.id)
					})
				})
		</script>
	</head>
	<body>
		<div id="root">
			<div id="woj"></div>
			<div id="miast"></div>
		</div>
	</body>
</html>
